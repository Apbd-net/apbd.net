<!DOCTYPE html><html lang="en" dir="ltr"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APBD.net: Request Food</title>
    <meta name="description" content="Request different foods, to be added to APBD.net's Foods List. Try it out - Help a cause!">

    <link rel="stylesheet" href="/css/foods/main.css">
    <link rel="stylesheet" href="/css/foods/dropdown.css">
    <link rel="stylesheet" href="/css/foods/contribute.css">
</head>

<!-- Google tag (gtag.js) -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-Y5TJK47MS3"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-Y5TJK47MS3');
</script>


<body>

    <script>
        const touch = matchMedia('(hover: none)').matches
        console.log(touch);

        if (touch) {
            let prev = window.document.body;
            window.addEventListener("touchend", function (e) {
                if (e.target.onclick) e.target.onclick();
                if (prev !== e.target) prev.classList.remove("hover");
                e.target.classList.toggle("hover");
                prev = e.target;
                console.log(e.target);
            }, { passive: false });
        }
    </script>
    <header>
        <div class="logo">
            <img src="/favicon.ico" alt="Website logo">
            <div class="column">
                <a class="title" href="https://apbd.net">APBD.net</a>
                <a class="sub" href="/">Allowed Foods List</a>
            </div>

        </div>
        <nav class="header-menu">
            <div class="dropdown">
                <a id="about" href="#">About</a>
                <div class="dropdown-content">
                    <a target="_blank" href="https://github.com/ShaharMS/APBD-FoodList/blob/main/README.md">Website</a>
                    <a target="_blank" href="https://rarediseases.org/rare-diseases/adult-polyglucosan-body-disease/">APBD
                        <span>‚Üó</span></a>
                    <a href="../about/database.html">Food Database</a>
                </div>
            </div>
            <div class="dropdown">
                <a id="contribute" href="#">Contribute</a>
                <div class="dropdown-content">
                    <a href="../contribute/request.html">Request data</a>
                    <a href="../contribute/provide.html">Provide data</a>
                    <a href="../contribute/leaderboards.html">Leaderboards</a>
                </div>
            </div>

            <div class="dropdown">
                <a id="contact" href="#">Language</a>
                <div class="dropdown-content">
                    <a onclick="window.location.href = window.location.href.replace(new RegExp('he|en'), 'en')" href="#">English</a>
                    <a onclick="window.location.href = window.location.href.replace(new RegExp('he|en'), 'he')" href="#">Hebrew</a>
                </div>
            </div>
        </nav>
    </header>

    <div class="container">
        <blockquote>This page exists to help you and other people, by expanding the list of documented foods. Don't hesitate to choose "I dont know" or "I'm not sure". I've got your back :)</blockquote>

        <div class="request-options">
            <div class="column" id="c1">
                <h2>Request Using: Details</h2>
                <table id="request-table">
                    <tbody><tr>
                        <th>
                            <help>Your first and last name. Used to add this contribution to the leaderboards, under your name. Contribute enough, and maybe one day you'll get to 1st place üòÅ</help>
                            <span>Name</span>
                        </th>
                        <td>
                            <input id="name1" oninput="document.getElementById('c2').style.display = document.getElementById('or').style.display = (this.value.length !== 0 || document.getElementById('n-np1').classList.contains('selected') ? 'none' : '')" placeholder="First and last name...">
                            <div class="button-row">
                                <button id="n-np1" type="button" onclick="document.getElementById('name1').value = ''; this.classList.toggle('selected'); document.getElementById('name1').oninput(); this.classList.toggle('selected')">I'd rather not provide</button>
                            </div>
                        </td>
                    </tr>
                    <tr>

                        <th>
                            <help>The Food's name. More useful to leave a concise name here, and if a company is involved, mention it after the fact.</help>
                            <span>Food name (english)</span>
                        </th>
                        <td>
                            <input id="food-name-english" placeholder="Food name...">
                            <div class="button-row">
                                <button id="fn-ns" type="button">I'm not sure</button>
                                <button id="fn-dk" type="button">I don't know</button>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th>
                            <help>For Translation purposes, It is a good idea to add the name in Hebrew. (makes my job a little easier üôÉ)</help>
                            <span>Food name (hebrew)</span>
                        </th>
                        <td>
                            <input id="food-name-hebrew" placeholder="◊©◊ù ◊î◊û◊ê◊õ◊ú...">
                            <div class="button-row">
                                <button id="t-ns" type="button">I'm not sure</button>
                                <button id="t-dk" type="button">I don't know</button>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th>
                            <help>If the specific food you're requesting is produced by a specific company, mention it here, This allows me to tag the item with the company and it's logo.</help>
                            <span>Optional: Food's Company</span>
                        </th>
                        <td>
                            <input id="company" list="companies" placeholder="Company Name...">
                            <datalist id="companies"></datalist>
                            <div class="button-row">
                                <button id="co-ns" type="button">I'm not sure</button>
                                <button id="co-dk" type="button">I don't know</button>
                            </div>
                        </td>
                    </tr>
                </tbody></table>
            </div>


            <h3 id="or">Or</h3>

            <div class="column" id="c2">
                <h2>Request Using: Images</h2>
                <table id="image-request-table">
                    <tbody><tr>
                        <th>
                            <help>Your first and last name. Used to add this contribution to the leaderboards, under your name. Contribute enough, and maybe one day you'll get to 1st place üòÅ</help>
                            <span>Name</span>
                        </th>
                        <td>
                            <input id="name2" oninput="document.getElementById('c1').style.display = document.getElementById('or').style.display = (this.value.length !== 0 || document.getElementById('n-np2').classList.contains('selected') ? 'none' : '')" placeholder="First and last name...">
                            <div class="button-row">
                                <button id="n-np2" type="button" onclick="document.getElementById('name2').value = ''; this.classList.toggle('selected'); document.getElementById('name2').oninput(); this.classList.toggle('selected')">I'd rather not provide</button>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th>
                            <help>The way the food looks from the front. On packaged food, usually contains the name of the food, it's company and what it actually is.</help>
                            <span>Food/Packaging's Front</span>
                        </th>
                        <td>
                            <div style="display: flex; width: 100%; flex-direction: row; justify-content: center;">
                                <img id="img1" width="0" height="0" style="display: none;">
                            </div>
                            <div class="button-row">
                                <button type="button" onclick="takeAndDisplay(this.parentElement.parentElement)">Take Image...</button>
                                <label for="image-picker1">Pick from the Gallery...</label>
                                <input id="image-picker1" type="file" accept="image/*" placeholder="Choose from the Gallery...">
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th>
                            <help>The way the food looks from the back. On packaged food, usually contains the food's nutrition facts, its ingredients, and more details about the food/its comapny.</help>
                            <span>Food/Packaging's Back</span>
                        </th>
                        <td>
                            <div style="display: flex; width: 100%; flex-direction: row; justify-content: center;">
                                <img id="img2" width="0" height="0" style="display: none;">
                            </div>
                            <div class="button-row">
                                <button type="button" onclick="takeAndDisplay(this.parentElement.parentElement)">Take Image...</button>
                                <label for="image-picker2">Pick from the Gallery...</label>
                                <input id="image-picker2" type="file" accept="image/*" placeholder="Choose from the Gallery...">
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th>
                            <help>Some food packages are thick, and contain extra info on one of their sides (for example, a cereal box). Use this field to provide an image, if necessary.</help>
                            <span>Optional: Food/Packaging's Side</span>
                        </th>
                        <td>
                            <div style="display: flex; width: 100%; flex-direction: row; justify-content: center;">
                                <img id="img3" width="0" height="0" style="display: none;">
                            </div>
                            <div class="button-row">
                                <button type="button" onclick="takeAndDisplay(this.parentElement.parentElement)">Take Image...</button>
                                <label for="image-picker3">Pick from the Gallery...</label>
                                <input id="image-picker3" type="file" accept="image/*" placeholder="Choose from the Gallery...">
                            </div>
                        </td>
                    </tr>
                </tbody></table>
            </div>

        </div>

        <button type="submit" id="submit">Submit</button>
        <h3 id="submition-output"></h3>

    </div>

    <script src="/js/foods/help-marks.js"></script>
    <script src="/js/foods/choice-buttons.js"></script>
    <script src="/js/foods/food-name-validator.js"></script>
    <script src="/js/foods/image-processor.js"></script>
    <script src="/js/foods/contribute.js"></script>

    <script>
        String.prototype.attemptedXSS = function () {
            return /[<>]/.test(this);
        }
        let submit = document.getElementById("submit");
        let output = document.getElementById("submition-output");
        submit.onclick = () => {
            let notice = confirm("Are you sure you want to submit?");
            if (!notice) return;

            submit.textContent = "Submitting...";

            if (document.getElementById('c1').style.display != "none") {
                output.innerHTML = "Grabbing Data From Text Fields...";

                let name = document.getElementById("name1").value;
                let name_RatherNotProvide = document.getElementById("n-np1").classList.contains("selected");
                if (name.length === 0 && !name_RatherNotProvide) {
                    output.innerHTML = "Please provide a name, or select 'I'd rather not provide'.";
                    submit.textContent = "Submit";
                    return;
                }

                let foodEn = document.getElementById("food-name-english").value;
                let foodEn_NotSure = document.getElementById("fn-ns").classList.contains("selected");
                let foodEn_DontKnow = document.getElementById("fn-dk").classList.contains("selected");
                let foodEn_Sureness = foodEn_DontKnow ? 0 : foodEn_NotSure ? 1 : 2;

                let foodHe = document.getElementById("food-name-hebrew").value;
                let foodHe_NotSure = document.getElementById("t-ns").classList.contains("selected");
                let foodHe_DontKnow = document.getElementById("t-dk").classList.contains("selected");
                let foodHe_Sureness = foodHe_DontKnow ? 0 : foodHe_NotSure ? 1 : 2;

                let foodCompany = document.getElementById("company").value;
                let foodCompanyObject = foodCompany.length === 0 ? null : localCompanyNameToObject(foodCompany, window.TABLE_JSON_DATA);

                output.innerHTML = "Testing For Attempted XSS Attacks...";

                if (name.attemptedXSS() || foodEn.attemptedXSS() || foodHe.attemptedXSS()) {
                    output.innerHTML = "Nice try üòâ";
                    submit.textContent = "Submit";
                    return;
                }

                if (document.getElementById("food-name-english").classList.contains("already-exists") || document.getElementById("food-name-hebrew").classList.contains("already-exists")) {
                    output.innerHTML = "Food already exists in the food list.";
                    submit.textContent = "Submit";
                    return;
                }

                output.innerHTML = "Building & Sending Request Packet...";
                requestUsingDetails(name, [foodEn, foodEn_Sureness], [foodHe, foodHe_Sureness], foodCompanyObject)
                    .then(response => {
                        output.innerHTML = response;
                        submit.textContent = "Submit";
                        document.getElementById("food-name-english").value = "";
                        document.getElementById("food-name-hebrew").value = "";
                        document.getElementById("company").value = "";
                    });
            }
            else {
                let name = document.getElementById("name2").value;
                let name_RatherNotProvide = document.getElementById("n-np2").classList.contains("selected");
                if (name.length === 0 && !name_RatherNotProvide) {
                    output.innerHTML = "Please provide a name, or select 'I'd rather not provide'.";
                    submit.textContent = "Submit";
                    return;
                }

                output.innerHTML = "Grabbing Images...";
                let imagebase64s = [];
                let canvas = document.createElement("canvas");
                for (let i = 1; i < 4; i++) {
                    let image = document.getElementById(`img${i}`);
                    image.width = 0; image.height = 0;
                    image.style.position = "absolute";
                    canvas.width = image.offsetWidth;
                    canvas.height = image.offsetHeight;                    
                    canvas.getContext("2d").drawImage(image, 0, 0);
                    image.src = "";
                    image.style.position = "none";
                    imagebase64s.push(canvas.toDataURL("image/png"));
                }
                
                requestUsingImages(name, imagebase64s)
                    .then(response => {
                        output.innerHTML = response;
                        submit.textContent = "Submit";
                    });
            }
        }
    </script>


</body></html>