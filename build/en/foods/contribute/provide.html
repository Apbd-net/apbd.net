<!DOCTYPE html>
<html lang="en" dir="ltr"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APBD.net: Provide Food Info</title>

    <meta name="description" content="Allows adding different foods to APBD.net's Food List directly via the website. Try it out - Help a cause!">

    <link rel="stylesheet" href="../style/main.css">
    <link rel="stylesheet" href="..//css/foods/dropdown.css">
    <link rel="stylesheet" href="../style/contribute.css">

<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-VPXMF38X8C"></script><script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-VPXMF38X8C');
</script></head>

<!-- Google tag (gtag.js) -->



<body>
    <script>
        const touch = matchMedia('(hover: none)').matches
        console.log(touch);

        if (touch) {
            let prev = window.document.body;
            window.addEventListener("touchend", function (e) {
                if (e.target.onclick) e.target.onclick();
                if (prev !== e.target) prev.classList.remove("hover");
                e.target.classList.toggle("hover");
                prev = e.target;
                console.log(e.target);
            }, { passive: false });
        }
    </script>
    <header>
        <div class="logo">
            <img src="../../../favicon.ico" alt="Website logo">
            <div class="column">
                <a class="title" href="https://apbd.net">APBD.net</a>
                <a class="sub" href="../">Allowed Foods List</a>
            </div>

        </div>
        <nav class="header-menu">
            <div class="dropdown">
                <a id="about" href="#">About</a>
                <div class="dropdown-content">
                    <a target="_blank" href="https://github.com/ShaharMS/APBD-FoodList/blob/main/README.md">Website</a>
                    <a target="_blank" href="https://rarediseases.org/rare-diseases/adult-polyglucosan-body-disease/">APBD
                        <span>‚Üó</span></a>
                    <a href="../about/database.html">Food Database</a>
                </div>
            </div>
            <div class="dropdown">
                <a id="contribute" href="#">Contribute</a>
                <div class="dropdown-content">
                    <a href="../contribute/request.html">Request data</a>
                    <a href="../contribute/provide.html">Provide data</a>
                    <a href="../contribute/leaderboards.html">Leaderboards</a>
                </div>
            </div>

            <div class="dropdown">
                <a id="contact" href="#">Language</a>
                <div class="dropdown-content">
                    <a onclick="window.location.href = window.location.href.replace(new RegExp('he|en'), 'en')" href="#">English</a>
                    <a onclick="window.location.href = window.location.href.replace(new RegExp('he|en'), 'he')" href="#">Hebrew</a>
                </div>
            </div>
        </nav>
    </header>

    <div class="container">
        <blockquote>This page exists to help you and other people, by expanding the list of documented foods. Don't hesitate to choose "I dont know" or "I'm not sure". I've got your back :)</blockquote>

        <form id="provide-form">
            <table id="provide-table">
                <tbody><tr>
                    <th>
                        <help>Your first and last name. Used to add this contribution to the leaderboards, under your name. Contribute enough, and maybe one day you'll get to 1st place üòÅ</help>
                        <span>Name</span>
                    </th>
                    <td>
                        <input id="name" placeholder="First and last name...">
                        <div class="button-row">
                            <button id="n-np" type="button">I'd rather not provide</button>
                        </div>
                    </td>
                </tr>
                <tr>

                    <th>
                        <help>The Food's name. More useful to leave a concise name here, and if a company is involved, mention it after the fact.</help>
                        <span>Food name (english)</span>
                    </th>
                    <td>
                        <input id="food-name-english" placeholder="Food name...">
                        <div class="button-row">
                            <button id="fn-ns" type="button">I'm not sure</button>
                            <button id="fn-dk" type="button">I don't know</button>
                        </div>
                    </td>
                </tr>
                <tr>
                    <th>
                        <help>For Translation purposes, It is a good idea to add the name in Hebrew. (makes my job a little easier üôÉ)</help>
                        <span>Food name (hebrew)</span>
                    </th>
                    <td>
                        <input id="food-name-hebrew" placeholder="◊©◊ù ◊î◊û◊ê◊õ◊ú...">
                        <div class="button-row">
                            <button id="t-ns" type="button">I'm not sure</button>
                            <button id="t-dk" type="button">I don't know</button>
                        </div>
                    </td>
                </tr>
                <tr>
                    <th>
                        <help>If the specific food you're requesting is produced by a specific company, mention it here, This allows me to tag the item with the company and it's logo.</help>
                        <span>Optional: Food's Company</span>
                    </th>
                    <td>
                        <input id="company" list="companies" placeholder="Company Name...">
                        <div class="button-row">
                            <button id="co-ns" type="button">I'm not sure</button>
                            <button id="co-dk" type="button">I don't know</button>
                        </div>
                    </td>
                </tr>
                <tr>
                    <th>
                        <help>Each food has a glycemic index, ranging from 0 to 100. A higher value spikes blood sugar higher and more rapidly.</help>
                        <span>Glycemic Index</span>
                    </th>
                    <td>
                        <input id="glycemic-index" type="number" min="0" max="100" placeholder="Between 0 and 100">
                        <div class="button-row">
                            <button id="gi-ns" type="button">I'm not sure</button>
                            <button id="gi-dk" type="button">I don't know</button>
                        </div>
                    </td>
                </tr>
                <tr>
                    <th>
                        <help>Glycemic Load is defined by the glycemic index, divided by 100, then multiplied by the amount of carbs the food contains (in grams). A higher value spikes blood sugar higher and more rapidly</help>
                        <span>Glycemic Load (Per 100g)</span>
                    </th>
                    <td>
                        <input id="glycemic-load" type="number" min="0" placeholder="Glycemic Load">
                        <div class="button-row">
                            <button id="gl-ns" type="button">I'm not sure</button>
                            <button id="gl-dk" type="button">I don't know</button>
                        </div>
                    </td>
                </tr>
                <tr>
                    <th>
                        <help>Sugar is one of the three types of carbohydrates. aside from it, there are also starches &amp; fibers. Fibers are 'ok' carbs, while starches &amp; sugars are 'bad' carbs.</help>
                        <span>Sugar (Per 100g)</span>
                    </th>
                    <td>
                        <input id="sugar" type="number" min="0" placeholder="Sugar (grams)">
                        <div class="button-row">
                            <button id="s-ns" type="button">I'm not sure</button>
                            <button id="s-dk" type="button">I don't know</button>
                        </div>
                    </td>
                </tr>
                <tr>
                    <th>
                        <help>Almost every single food contains carbohydrates. Our body uses them to generate energy</help>
                        <span>Carbs (Per 100g)</span>
                    </th>
                    <td>
                        <input id="carbs" type="number" min="0" placeholder="Carbs (grams)">
                        <div class="button-row">
                            <button id="c-ns" type="button">I'm not sure</button>
                            <button id="c-dk" type="button">I don't know</button>
                        </div>
                    </td>
                </tr>
            </tbody></table>
        </form>

        <div class="row">
            <button type="submit" id="submit">Submit</button>
        </div>
        <h3 id="submition-output"></h3>


        <script>
            String.prototype.attemptedXSS = function () {
                return /[<>]/.test(this);
            }


            let submit = document.getElementById("submit");
            let output = document.getElementById("submition-output");

            submit.onclick = () => {

                let notice = confirm("Are you sure you want to submit?");
                if (!notice) return;

                submit.textContent = "Submitting...";

                output.innerHTML = "Grabbing Data From Text Fields...";

                let name = document.getElementById("name").value;
                let name__RatherNotProvide = document.getElementById("n-np").classList.contains("selected");

                if (name.length === 0 && !name__RatherNotProvide) {
                    output.innerHTML = "Please provide a name, or select 'I'd rather not provide'.";
                    submit.textContent = "Submit";
                    return;
                }

                let foodName = document.getElementById("food-name-english").value;
                let foodName__NotSure = document.getElementById("fn-ns").classList.contains("selected");
                let foodName__DontKnow = document.getElementById("fn-dk").classList.contains("selected");

                if (foodName.length === 0 && !foodName__DontKnow) {
                    output.innerHTML = "Please provide a food name, or select 'I don't know'.";
                    submit.textContent = "Submit";
                    return;
                }

                let translations = document.getElementById("food-name-hebrew").value;
                let translations__NotSure = document.getElementById("t-ns").classList.contains("selected");
                let translations__DontKnowAny = document.getElementById("t-dk").classList.contains("selected");

                let company = document.getElementById("company").value;
                let company__NotSure = document.getElementById("co-ns").classList.contains("selected");
                let company__DontKnowAny = document.getElementById("co-dk").classList.contains("selected");

                let glycemicIndex = document.getElementById("glycemic-index").value;
                let glycemicIndex__NotSure = document.getElementById("gi-ns").classList.contains("selected");
                let glycemicIndex__DontKnow = document.getElementById("gi-dk").classList.contains("selected");

                if (glycemicIndex.length === 0 && !glycemicIndex__DontKnow) {
                    output.innerHTML = "Please provide a glycemic index, or select 'I don't know'.";
                    submit.textContent = "Submit";
                    return;
                }

                let glycemicLoad = document.getElementById("glycemic-load").value;
                let glycemicLoad__NotSure = document.getElementById("gl-ns").classList.contains("selected");
                let glycemicLoad__DontKnow = document.getElementById("gl-dk").classList.contains("selected");

                if (glycemicLoad.length === 0 && !glycemicLoad__DontKnow) {
                    output.innerHTML = "Please provide a glycemic load, or select 'I don't know'.";
                    submit.textContent = "Submit";
                    return;
                }

                let sugar = document.getElementById("sugar").value;
                let sugar__NotSure = document.getElementById("s-ns").classList.contains("selected");
                let sugar__DontKnow = document.getElementById("s-dk").classList.contains("selected");

                if (sugar.length === 0 && !sugar__DontKnow) {
                    output.innerHTML = "Please provide sugar amount, or select 'I don't know'.";
                    submit.textContent = "Submit";
                    return;
                }

                let carbs = document.getElementById("carbs").value;
                let carbs__NotSure = document.getElementById("c-ns").classList.contains("selected");
                let carbs__DontKnow = document.getElementById("c-dk").classList.contains("selected");

                if (carbs.length === 0 && !carbs__DontKnow) {
                    output.innerHTML = "Please provide carbs amount, or select 'I don't know'.";
                    submit.textContent = "Submit";
                    return;
                }

                if (document.getElementById("food-name-english").classList.contains("already-exists") || document.getElementById("food-name-hebrew").classList.contains("already-exists")) {
                    output.innerHTML = "Food already exists in the food list.";
                    submit.textContent = "Submit";
                    return;
                }

                output.innerHTML = "Testing For Attempted XSS Attacks...";

                if (name.attemptedXSS() || foodName.attemptedXSS() || glycemicIndex.attemptedXSS() || glycemicLoad.attemptedXSS() || sugar.attemptedXSS() || carbs.attemptedXSS() || translations.attemptedXSS()) {
                    output.innerHTML = "Nice try üòâ";
                    submit.textContent = "Submit";
                    return;
                }

                output.innerHTML = "Building Submission Packet...";

                let payload = {
                    type: "provide",
                    name: name.length === 0 || name__RatherNotProvide ? "Anonymous" : name,
                    foodEnglish: foodName.length === 0 ? "<english not given>" : foodName,
                    foodEnglishSecurity: foodName__DontKnow ? 0 : (foodName__NotSure ? 1 : 2),
                    foodHebrew: translations.length === 0 ? "<hebrew not given>" : translations,
                    foodHebrewSecurity: translations__DontKnowAny ? 0 : (translations__NotSure ? 1 : 2),
                    glycemicIndex: glycemicIndex.length === 0 ? -1 : parseFloat(glycemicIndex),
                    glycemicIndexSecurity: glycemicIndex__DontKnow ? 0 : (glycemicIndex__NotSure ? 1 : 2),
                    glycemicLoad: glycemicLoad.length === 0 ? -1 : parseFloat(glycemicLoad),
                    glycemicLoadSecurity: glycemicLoad__DontKnow ? 0 : (glycemicLoad__NotSure ? 1 : 2),
                    sugar: sugar.length === 0 ? -1 : parseFloat(sugar),
                    sugarSecurity: sugar__DontKnow ? 0 : (sugar__NotSure ? 1 : 2),
                    carbs: carbs.length === 0 ? -1 : parseFloat(carbs),
                    carbsSecurity: carbs__DontKnow ? 0 : (carbs__NotSure ? 1 : 2),
                    company: company.length === 0 ? null : company,
                }

                if (payload.foodEnglishSecurity == 0 && payload.foodHebrewSecurity == 0 && payload.glycemicIndexSecurity == 0) {
                    output.innerHTML = "Contribution not submitted: not enough information provided.";
                    submit.textContent = "Submit";
                    return;
                } else {
                    output.innerHTML = "Sending Submission Packet...";
                    fetch("https://apbd-contrib-bot.shaharmsecond.workers.dev/", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify(payload),
                    })
                        .then(response => {
                            output.innerHTML = "Getting Response...";
                            return response.text();
                        })
                        .then(data => {
                            output.innerHTML = data;
                            submit.textContent = "Submit";
                        });
                }


            }   
        </script>

    </div>

    <script src="../code/help-marks.js"></script>
    <script src="../code/choice-buttons.js"></script>
    <script src="../code/food-name-validator.js"></script>

    <script type="module">
        activateHelpMarks();
        activateChoiceButtons();
        activateFoodNameValidator();
    </script>


</body></html>