<!DOCTYPE html>
<html lang-en="en" lang-he="he" dir-he="rtl" dir-en="ltr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title en="APBD.net: Request Food" he="APBD.net: 拽砖转 "></title>
    <meta name="description"
        content-en="Request different foods, to be added to APBD.net's Foods List. Try it out - Help a cause!"
        content-he="- 驻砖专 拽砖  砖, 注 转 砖 住祝 转 专砖转  砖 APBD.net. 拽砖  - 注砖 !&rlm;">

    <link rel="stylesheet" href="../style/main.css">
    <link rel="stylesheet" href="../style/dropdown.css">
    <link rel="stylesheet" href="../style/contribute.css">
</head>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-VPXMF38X8C"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-VPXMF38X8C');
</script>

<body>

    <script>
        const touch = matchMedia('(hover: none)').matches
        console.log(touch);

        if (touch) {
            let prev = window.document.body;
            window.addEventListener("touchend", function (e) {
                if (e.target.onclick) e.target.onclick();
                if (prev !== e.target) prev.classList.remove("hover");
                e.target.classList.toggle("hover");
                prev = e.target;
                console.log(e.target);
            }, { passive: false });
        }
    </script>
    <header>
        <div class="logo">
            <img src="../favicon.ico" alt="Website logo">
            <div class="column">
                <a class="title" href="https://apbd.net">APBD.net</a>
                <a class="sub" href="../"
                    en="Allowed Foods List" he="专砖转  转专">
                    Allowed Foods List
                </a>
            </div>

        </div>
        <nav class="header-menu">
            <div class="dropdown">
                <a id="about" href="#" en="About" he="转">About</a>
                <div class="dropdown-content">
                    <a target="_blank" href="https://github.com/ShaharMS/APBD-FoodList/blob/main/README.md" en="Website"
                        he="转专">Website<span>&UpperRightArrow;</span></a>
                    <a target="_blank"
                        href="https://rarediseases.org/rare-diseases/adult-polyglucosan-body-disease/">APBD
                        <span>&UpperRightArrow;</span></a>
                    <a onclick="window.location.href = window.location.origin + `/about/database${'_' + (new URLSearchParams(window.location.search).get('lang') || 'en')}.html` + window.location.search"
                        href="#" en="Food Database" he="住 转">Food Database</a>
                </div>
            </div>
            <div class="dropdown">
                <a id="contribute" href="#" en="Contribute" he="转专 转">Contribute</a>
                <div class="dropdown-content">
                    <a href="../contribute/request.html" en="Request data" he="拽砖转 转">Request data</a>
                    <a href="../contribute/provide.html" en="Provide data" he="住驻拽 转">Provide data</a>
                    <a href="../contribute/leaderboards.html" en="Leaderboards" he="转专 ">Leaderboards</a>
                </div>
            </div>

            <div class="dropdown">
                <a id="contact" href="#" en="Language" he="砖驻">Language</a>
                <div class="dropdown-content">
                    <a onclick="window.location.href = window.location.href.replace(new RegExp('he|en'), 'en')" href="#"
                        en="English" he="转">English</a>
                    <a onclick="window.location.href = window.location.href.replace(new RegExp('he|en'), 'he')" href="#"
                        en="Hebrew" he="注专转">Hebrew</a>
                </div>
            </div>
        </nav>
    </header>

    <div class="container">
        <blockquote
            en="This page exists to help you and other people, by expanding the list of documented foods. Don't hesitate to choose &quot;I dont know&quot; or &quot;I'm not sure&quot;. I've got your back :)"
            he="注  拽 注 转 驻砖专  砖 专 注专  砖, 注&quot; 专 砖 专砖转  转注.  爪专 砖砖   /注 注 住 -  注  :)&rlm;">
        </blockquote>

        <div class="request-options">
            <div class="column">
                <h2 en="Request Using: Details" he="拽砖 爪注转: 驻专"></h2>
                <form id="request-form">
                    <table id="request-table">
                        <tr>
                            <th>
                                <help
                                    en="Your first and last name. Used to add this contribution to the leaderboards, under your name. Contribute enough, and maybe one day you'll get to 1st place "
                                    he="砖 驻专 + 砖驻 砖.  转, 砖砖 转专   砖, 砖转转 转住祝 转专转 转. 转专 住驻拽 转,  转注 拽 专砖 &rlm;">
                                </help>
                                <span en="Name" he="砖">Name</span>
                            </th>
                            <td>
                                <input id="name" placeholder-en="First and last name..."
                                    placeholder-he="砖 驻专 砖 砖驻...">
                                <div class="button-row">
                                    <button id="n-np" type="button" en="I'd rather not provide" he="注祝 砖 住专">I'd
                                        rather not provide</button>
                                </div>
                            </td>
                        </tr>
                        <tr>

                            <th>
                                <help
                                    en="The Food's name. More useful to leave a concise name here, and if a company is involved, mention it after the fact."
                                    he="砖  转 转 专爪 住祝. 注祝  砖 拽 转专  驻砖专 (  砖 注).  注专转 专 住转 爪专 , 转 专 转 砖 驻专.&rlm;">
                                </help>
                                <span en="Food name (english)" he="砖  (转)">">Food name (english)</span>
                            </th>
                            <td>
                                <input id="food-name-english" placeholder="Food name...">
                                <div class="button-row">
                                    <button id="fn-ns" type="button" en="I'm not sure" he="  ">I'm not
                                        sure</button>
                                    <button id="fn-dk" type="button" en="I don't know" he="  注">I don't
                                        know</button>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <th>
                                <help
                                    en="For Translation purposes, It is a good idea to add the name in Hebrew. (makes my job a little easier )"
                                    he="专转 转专, 抓 转转  转 砖  注专转 (驻  转 注 拽 转专 )&rlm;">
                                </help>
                                <span en="Food name (hebrew)" he="砖  (注专转)">">Food name (hebrew)</span>
                            </th>
                            <td>
                                <input id="food-name-hebrew" placeholder="砖 ...">
                                <div class="button-row">
                                    <button id="t-ns" type="button" en="I'm not sure" he="  ">I'm not
                                        sure</button>
                                    <button id="t-dk" type="button" en="I don't know" he="  注">>I don't
                                        know</button>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <th>
                                <help
                                    en="If the specific food you're requesting is produced by a specific company, mention it here, This allows me to tag the item with the company and it's logo."
                                    he=" 爪专 住驻爪驻 转 转 拽砖 爪专 注&quot; 专 住转, 转专 转 砖 .  转  爪 转 砖  专 爪专 转专 注爪.&rlm;">
                                </help>
                                <span en="Optional: Food's Company" he="驻爪: 砖 专">Optional: Food's
                                    Company</span>
                            </th>
                            <td>
                                <input id="company" placeholder-en="Company Name..." placeholder-he="砖 专..."
                                    list="companies">
                                <div class="button-row">
                                    <button id="co-ns" type="button" en="I'm not sure" he="  ">I'm not
                                        sure</button>
                                    <button id="co-dk" type="button" en="I don't know" he="  注">I don't
                                        know</button>
                                </div>
                            </td>
                        </tr>
                    </table>
                </form>
            </div>


            <h3 en="Or" he=""></h3>

            <div class="column">
                <h2 en="Request Using: Images" he="拽砖 爪注转: 转转"></h2>
                <form id="image-request-form">
                    <table id="image-request-table">
                        <tr>
                            <th>
                                <help
                                    en="The way the food looks from the front. On packaged food, usually contains the name of the food, it's company and what it actually is."
                                    he="  专 砖专 拽 砖 爪.  专, 拽 拽 砖  &quot;  转 砖 , 专 砖爪专转 转,  注爪 .&rlm;">
                                </help>
                                <span en="Food/Packaging's Front" he="/专 - 拽"></span>
                            </th>
                            <td>
                                <div style="display: flex; width: 100%; flex-direction: row; justify-content: center;">
                                    <img width="0" height="0" style="display: none;" />
                                </div>
                                <div class="button-row">
                                    <button type="button"
                                        onclick="takeAndDisplay(this.parentElement.parentElement)" en="Take Image..." he="爪 转...">Take Image</button>
                                    <label for="image-picker" en="Pick from the Gallery..."
                                        he="专 转 专..."></label>
                                    <input id="image-picker" type="file" accept="image/*"
                                        placeholder-en="Choose from the Gallery..."
                                        placeholder-he="专 转 专..." />
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <th>
                                <help
                                    en="The way the food looks from the back. On packaged food, usually contains the food's nutrition facts, its ingredients, and more details about the food/its comapny."
                                    he="  专 砖专 拽 专 爪.  专, 拽 专 专  转 注专 转转 砖 , 专 砖, 注 驻专 住驻 注 /专.&rlm;">
                                </help>
                                <span en="Food/Packaging's Back" he="/专 - 专"></span>
                            </th>
                            <td>
                                <div style="display: flex; width: 100%; flex-direction: row; justify-content: center;">
                                    <img width="0" height="0" style="display: none;" />
                                </div>
                                <div class="button-row">
                                    <button type="button"
                                        onclick="takeAndDisplay(this.parentElement.parentElement)" en="Take Image..." he="爪 转...">Take Image</button>
                                    <label for="image-picker" en="Pick from the Gallery..."
                                        he="专 转 专..."></label>
                                    <input id="image-picker" type="file" accept="image/*"
                                        placeholder-en="Choose from the Gallery..."
                                        placeholder-he="专 转 专..." />
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <th>
                                <help
                                    en="Some food packages are thick, and contain extra info on one of their sides (for example, a cereal box). Use this field to provide an image, if necessary."
                                    he="拽 专转  注转, 砖  注 住祝 注  爪 砖 ( - 专转 拽专驻拽住). 驻砖专 砖转砖 砖   砖 爪专 转 住驻转 爪.&rlm;">
                                </help>
                                <span en="Optional: Food/Packaging's Side" he="驻爪: /专 - 爪"></span>
                            </th>
                            <td>
                                <div style="display: flex; width: 100%; flex-direction: row; justify-content: center;">
                                    <img width="0" height="0" style="display: none;" />
                                </div>
                                <div class="button-row">
                                    <button type="button"
                                        onclick="takeAndDisplay(this.parentElement.parentElement)" en="Take Image..." he="爪 转...">Take Image</button>
                                    <label for="image-picker" en="Pick from the Gallery..."
                                        he="专 转 专..."></label>
                                    <input id="image-picker" type="file" accept="image/*"
                                        placeholder-en="Choose from the Gallery..."
                                        placeholder-he="专 转 专..." />
                                </div>
                            </td>
                        </tr>
                    </table>
                </form>
            </div>

        </div>


        <div class="row">
            <button type="submit" id="submit" en="Submit" he="砖">Submit</button>
        </div>
        <h3 id="submition-output"></h3>


    </div>

    <script src="../code/help-marks.js"></script>
    <script src="../code/choice-buttons.js"></script>
    <script src="../code/food-name-validator.js"></script>
    <script src="../code/image-processor.js"></script>

    <script>
        String.prototype.attemptedXSS = function () {
            return /[<>]/.test(this);
        }
        let submit = document.getElementById("submit");
        let output = document.getElementById("submition-output");
        submit.onclick = () => {
            console.log(languageIndex);
            let notice = confirm("Are you sure you want to submit?");
            if (!notice) return;

            submit.textContent = "Submitting...";

            output.innerHTML = "Grabbing Data From Text Fields...";

            let name = document.getElementById("name").value;
            let name_RatherNotProvide = document.getElementById("n-np").classList.contains("selected");

            if (name.length === 0 && !name_RatherNotProvide) {
                output.innerHTML = "Please provide a name, or select 'I'd rather not provide'.";
                submit.textContent = "Submit";
                return;
            }

            let foodName = document.getElementById("food-name-english").value;
            let foodName_NotSure = document.getElementById("fn-ns").classList.contains("selected");
            let foodName_DontKnow = document.getElementById("fn-dk").classList.contains("selected");

            if (foodName.length === 0 && !foodName_DontKnow) {
                output.innerHTML = "Please provide an english translation of the food name, or select 'I don't know'.";
                submit.textContent = "Submit";
                return;
            }

            let translations = document.getElementById("food-name-hebrew").value;
            let translations_NotSure = document.getElementById("t-ns").classList.contains("selected");
            let translations_DontKnow = document.getElementById("t-dk").classList.contains("selected");

            if (translations.length === 0 && !translations_DontKnow) {
                output.innerHTML = "Please provide a hebrew translation of the food name, or select 'I don't know'.";
                submit.textContent = "Submit";
                return;
            }

            output.innerHTML = "Testing For Attempted XSS Attacks...";

            if (name.attemptedXSS() || foodName.attemptedXSS() || translations.attemptedXSS()) {
                output.innerHTML = "Nice try ";
                submit.textContent = "Submit";
                return;
            }

            if (document.getElementById("food-name-english").classList.contains("already-exists") || document.getElementById("food-name-hebrew").classList.contains("already-exists")) {
                output.innerHTML = "Food already exists in the food list.";
                submit.textContent = "Submit";
                return;
            }

            output.innerHTML = "Building Request Packet...";

            let payload = {
                type: "request",
                name: name.length === 0 || name_RatherNotProvide ? "Anonymous" : name,
                foodEnglish: foodName.length === 0 ? "Not Given" : foodName,
                foodEnglishSecurity: foodName_DontKnow ? 0 : (foodName_NotSure ? 1 : 2),
                foodHebrew: translations.length === 0 || translations_DontKnow ? "Not Given" : translations,
                foodHebrewSecurity: translations_DontKnow ? 0 : (translations_NotSure ? 1 : 2),
            }

            if (foodName_DontKnow && translations_DontKnow) {
                // Ignore "nonsense" requests
                output.innerHTML = "Request not submitted: no information provided.";
                submit.textContent = "Submit";
                return;
            } else {
                output.innerHTML = "Sending Request Packet...";
                fetch("https://apbd-contrib-bot.shaharmsecond.workers.dev/", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify(payload),
                })
                    .then(response => {
                        output.innerHTML = "Getting Response...";
                        return response.text();
                    })
                    .then(data => {
                        output.innerHTML = data;
                        submit.textContent = "Submit";
                    });
            }
        }
    </script>

    <script type="module">
        let urlParams = new URLSearchParams(window.location.search);

        let lang = urlParams.get("lang") || "en";
        activateHelpMarks();
        activateChoiceButtons();
        activateFoodNameValidator();
    </script>
</body>

</html>