<!DOCTYPE html>
<html lang-en="en" lang-he="he" dir-he="rtl" dir-en="ltr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title en="APBD.net: Request Food" he="APBD.net: בקשת מאכל"></title>
    <meta name="description"
        content-en="Request different foods, to be added to APBD.net's Foods List. Try it out - Help a cause!"
        content-he="-כאן אפשר לבקש מאכלים שונים, על מנת שנוכל להוסיף אותם לרשימת המאכלים שלנו בAPBD.net. בקש מאכל - עשה טוב!&rlm;">

    <link rel="stylesheet" href="/css/foods/main.css">
    <link rel="stylesheet" href="/css/foods/dropdown.css">
    <link rel="stylesheet" href="/css/foods/contribute.css">
</head>

<!-- Google tag (gtag.js) -->

<body>

    <script>
        const touch = matchMedia('(hover: none)').matches
        console.log(touch);

        if (touch) {
            let prev = window.document.body;
            window.addEventListener("touchend", function (e) {
                if (e.target.onclick) e.target.onclick();
                if (prev !== e.target) prev.classList.remove("hover");
                e.target.classList.toggle("hover");
                prev = e.target;
                console.log(e.target);
            }, { passive: false });
        }
    </script>
    <header>
        <div class="logo">
            <img src="/favicon.ico" alt="Website logo">
            <div class="column">
                <a class="title" href="https://apbd.net">APBD.net</a>
                <a class="sub" href="/" en="Allowed Foods List" he="רשימת מאכלים מותרים">
                    Allowed Foods List
                </a>
            </div>

        </div>
        <nav class="header-menu">
            <div class="dropdown">
                <a id="about" href="#" en="About" he="אודות">About</a>
                <div class="dropdown-content">
                    <a target="_blank" href="https://github.com/ShaharMS/APBD-FoodList/blob/main/README.md" en="Website"
                        he="אתר">Website<span>&UpperRightArrow;</span></a>
                    <a target="_blank"
                        href="https://rarediseases.org/rare-diseases/adult-polyglucosan-body-disease/">APBD
                        <span>&UpperRightArrow;</span></a>
                    <a href="../about/database.html" en="Food Database" he="מסד הנתונים">Food Database</a>
                </div>
            </div>
            <div class="dropdown">
                <a id="contribute" href="#" en="Contribute" he="תרום תוכן">Contribute</a>
                <div class="dropdown-content">
                    <a href="../contribute/request.html" en="Request data" he="בקשת נתונים">Request data</a>
                    <a href="../contribute/provide.html" en="Provide data" he="סיפוק נתונים">Provide data</a>
                    <a href="../contribute/leaderboards.html" en="Leaderboards" he="תורמים מובילים">Leaderboards</a>
                </div>
            </div>

            <div class="dropdown">
                <a id="contact" href="#" en="Language" he="שפה">Language</a>
                <div class="dropdown-content">
                    <a onclick="window.location.href = window.location.href.replace(new RegExp('he|en'), 'en')" href="#"
                        en="English" he="אנגלית">English</a>
                    <a onclick="window.location.href = window.location.href.replace(new RegExp('he|en'), 'he')" href="#"
                        en="Hebrew" he="עברית">Hebrew</a>
                </div>
            </div>
        </nav>
    </header>

    <div class="container">
        <blockquote
            en="This page exists to help you and other people, by expanding the list of documented foods. Don't hesitate to choose &quot;I dont know&quot; or &quot;I'm not sure&quot;. I've got your back :)"
            he="העמוד הזה קיים על מנת לאפשר לך ולאנשים אחרים לעזור אחד לשני, ע&quot;י הרחבה של רשימת המאכלים המתועדים. אין צורך לחשוש אם לא בטוחים/יודעים מידע מסוים - אני על זה :)&rlm;">
        </blockquote>

        <div class="request-options">
            <div class="column" id="c1">
                <h2 en="Request Using: Details" he="בקשה באמצעות: פרטים"></h2>
                <table id="request-table">
                    <tr>
                        <th>
                            <help
                                en="Your first and last name. Used to add this contribution to the leaderboards, under your name. Contribute enough, and maybe one day you'll get to 1st place 😁"
                                he="השם הפרטי + משפחה שלך. אם ניתן, ישמש בתור מזהה בלוח ההישגים, שתחתיו תווסף תרומת התוכן. תרום מספיק תוכן, ואולי תגיע למקום הראשון 😁&rlm;">
                            </help>
                            <span en="Name" he="שם">Name</span>
                        </th>
                        <td>
                            <input id="name1" placeholder-en="First and last name..."
                                placeholder-he="שם פרטי ושם משפחה..."
                                oninput="document.getElementById('c2').style.display = document.getElementById('or').style.display = (this.value.length !== 0 || document.getElementById('n-np1').classList.contains('selected') ? 'none' : '')">
                            <div class="button-row">
                                <button id="n-np1" type="button" en="I'd rather not provide" he="מעדיף שלא למסור"
                                    onclick="document.getElementById('name1').value = ''; this.classList.toggle('selected'); document.getElementById('name1').oninput(); this.classList.toggle('selected')">
                                    I'd rather not provide
                                </button>
                            </div>
                        </td>
                    </tr>
                    <tr>

                        <th>
                            <help
                                en="The Food's name. More useful to leave a concise name here, and if a company is involved, mention it after the fact."
                                he="שם המאכל אותו אתה רוצה להוסיף. עדיף להביא שם ממוקד יותר אם אפשר (כמובן מבלי להשמיט מידע). אם מעורבת חברה מסוימת ביצור האוכל, ניתן להזכיר זאת בשדה נפרד.&rlm;">
                            </help>
                            <span en="Food name (english)" he="שם המאכל (אנגלית)">">Food name (english)</span>
                        </th>
                        <td>
                            <input id="food-name-english" placeholder="Food name...">
                            <div class="button-row">
                                <button id="fn-ns" type="button" en="I'm not sure" he="אני לא בטוח">I'm not
                                    sure</button>
                                <button id="fn-dk" type="button" en="I don't know" he="אני לא יודע">I don't
                                    know</button>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th>
                            <help
                                en="For Translation purposes, It is a good idea to add the name in Hebrew. (makes my job a little easier 🙃)"
                                he="למטרות תרגום, מומלץ לתת גם את שם המאכל בעברית (הופך לי את העבודה לקלה יותר 🙃)&rlm;">
                            </help>
                            <span en="Food name (hebrew)" he="שם המאכל (עברית)">">Food name (hebrew)</span>
                        </th>
                        <td>
                            <input id="food-name-hebrew" placeholder="שם המאכל...">
                            <div class="button-row">
                                <button id="t-ns" type="button" en="I'm not sure" he="אני לא בטוח">I'm not
                                    sure</button>
                                <button id="t-dk" type="button" en="I don't know" he="אני לא יודע">>I don't
                                    know</button>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th>
                            <help
                                en="If the specific food you're requesting is produced by a specific company, mention it here, This allows me to tag the item with the company and it's logo."
                                he="אם המוצר הספציפי אותו אתה מבקש מיוצר ע&quot;י חברה מסוימת, תזכיר את שמה כאן. זה נותן לי להצמיד את שם ולוגו החברה למוצר באתר עצמו.&rlm;">
                            </help>
                            <span en="Optional: Food's Company" he="אופציונאלי: שם החברה">Optional: Food's
                                Company</span>
                        </th>
                        <td>
                            <input id="company" placeholder-en="Company Name..." placeholder-he="שם החברה..."
                                list="companies">
                            <datalist id="companies"></datalist>
                            <div class="button-row">
                                <button id="co-ns" type="button" en="I'm not sure" he="אני לא בטוח">I'm not
                                    sure</button>
                                <button id="co-dk" type="button" en="I don't know" he="אני לא יודע">I don't
                                    know</button>
                            </div>
                        </td>
                    </tr>
                </table>
            </div>


            <h3 en="Or" he="או" id="or"></h3>

            <div class="column" id="c2">
                <h2 en="Request Using: Images" he="בקשה באמצעות: תמונות"></h2>
                <table id="image-request-table">
                    <tr>
                        <th>
                            <help
                                en="Your first and last name. Used to add this contribution to the leaderboards, under your name. Contribute enough, and maybe one day you'll get to 1st place 😁"
                                he="השם הפרטי + משפחה שלך. אם ניתן, ישמש בתור מזהה בלוח ההישגים, שתחתיו תווסף תרומת התוכן. תרום מספיק תוכן, ואולי תגיע למקום הראשון 😁&rlm;">
                            </help>
                            <span en="Name" he="שם">Name</span>
                        </th>
                        <td>
                            <input id="name2" placeholder-en="First and last name..."
                                placeholder-he="שם פרטי ושם משפחה..."
                                oninput="document.getElementById('c1').style.display = document.getElementById('or').style.display = (this.value.length !== 0 || document.getElementById('n-np2').classList.contains('selected') ? 'none' : '')">
                            <div class="button-row">
                                <button id="n-np2" type="button" en="I'd rather not provide" he="מעדיף שלא למסור"
                                    onclick="document.getElementById('name2').value = ''; this.classList.toggle('selected'); document.getElementById('name2').oninput(); this.classList.toggle('selected')">I'd
                                    rather not provide</button>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th>
                            <help
                                en="The way the food looks from the front. On packaged food, usually contains the name of the food, it's company and what it actually is."
                                he="איך האוכל נראה כאשר הקדימה שלו מצולם. במאכלים ארוזים, החלק הקדמי של החבילה בד&quot;כ מכיל את שם האוכל, החברה שמייצרת אותו, ומה בעצם האוכל.&rlm;">
                            </help>
                            <span en="Food/Packaging's Front" he="אוכל/מארז - מקדימה"></span>
                        </th>
                        <td>
                            <div style="display: flex; width: 100%; flex-direction: row; justify-content: center;">
                                <img id="img1" width="0" height="0" style="display: none;" />
                            </div>
                            <div class="button-row">
                                <button type="button" onclick="takeAndDisplay(this.parentElement.parentElement)"
                                    en="Take Image..." he="צלם תמונה...">Take Image</button>
                                <label for="image-picker1" en="Pick from the Gallery..."
                                    he="בחר תמונה מהגלריה..."></label>
                                <input id="image-picker1" type="file" accept="image/*"
                                    placeholder-en="Choose from the Gallery..." placeholder-he="בחר תמונה מהגלריה..." />
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th>
                            <help
                                en="The way the food looks from the back. On packaged food, usually contains the food's nutrition facts, its ingredients, and more details about the food/its comapny."
                                he="איך האוכל נראה כאשר חלקו האחורי מצולם. במאכלים ארוזים, החלק האחורי לרוב מכיל את הערכים התזונתיים של המאכל, המרכיבים שלו, ועוד פרטים נוספים על המאכל/החברה.&rlm;">
                            </help>
                            <span en="Food/Packaging's Back" he="אוכל/מארז - מאחורה"></span>
                        </th>
                        <td>
                            <div style="display: flex; width: 100%; flex-direction: row; justify-content: center;">
                                <img id="img2" width="0" height="0" style="display: none;" />
                            </div>
                            <div class="button-row">
                                <button type="button" onclick="takeAndDisplay(this.parentElement.parentElement)"
                                    en="Take Image..." he="צלם תמונה...">Take Image</button>
                                <label for="image-picker2" en="Pick from the Gallery..."
                                    he="בחר תמונה מהגלריה..."></label>
                                <input id="image-picker2" type="file" accept="image/*"
                                    placeholder-en="Choose from the Gallery..." placeholder-he="בחר תמונה מהגלריה..." />
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th>
                            <help
                                en="Some food packages are thick, and contain extra info on one of their sides (for example, a cereal box). Use this field to provide an image, if necessary."
                                he="חלק מאריזות המאכלים עבות, ויש להן מידע נוסף על אחד הצדדים שלהם (לדוגמה - אריזות קורנפלקס). אפשר להשתמש בשדה זה אם יש צורך בתמונה נוספת מהצד.&rlm;">
                            </help>
                            <span en="Optional: Food/Packaging's Side" he="אופציונאלי: אוכל/מארז - מהצד"></span>
                        </th>
                        <td>
                            <div style="display: flex; width: 100%; flex-direction: row; justify-content: center;">
                                <img id="img3" width="0" height="0" style="display: none;" />
                            </div>
                            <div class="button-row">
                                <button type="button" onclick="takeAndDisplay(this.parentElement.parentElement)"
                                    en="Take Image..." he="צלם תמונה...">Take Image</button>
                                <label for="image-picker3" en="Pick from the Gallery..."
                                    he="בחר תמונה מהגלריה..."></label>
                                <input id="image-picker3" type="file" accept="image/*"
                                    placeholder-en="Choose from the Gallery..." placeholder-he="בחר תמונה מהגלריה..." />
                            </div>
                        </td>
                    </tr>
                </table>
            </div>

        </div>

        <button type="submit" id="submit" en="Submit" he="שלח">Submit</button>
        <h3 id="submition-output"></h3>

    </div>

    <script src="/js/foods/help-marks.js"></script>
    <script src="/js/foods/choice-buttons.js"></script>
    <script src="/js/foods/food-name-validator.js"></script>
    <script src="/js/foods/image-processor.js"></script>
    <script src="/js/foods/contribute.js"></script>

    <script>
        String.prototype.attemptedXSS = function () {
            return /[<>]/.test(this);
        }
        let submit = document.getElementById("submit");
        let output = document.getElementById("submition-output");
        submit.onclick = () => {
            let notice = confirm("Are you sure you want to submit?");
            if (!notice) return;

            submit.textContent = "Submitting...";

            if (document.getElementById('c1').style.display != "none") {
                output.innerHTML = "Grabbing Data From Text Fields...";

                let name = document.getElementById("name1").value;
                let name_RatherNotProvide = document.getElementById("n-np1").classList.contains("selected");
                if (name.length === 0 && !name_RatherNotProvide) {
                    output.innerHTML = "Please provide a name, or select 'I'd rather not provide'.";
                    submit.textContent = "Submit";
                    return;
                }

                let foodEn = document.getElementById("food-name-english").value;
                let foodEn_NotSure = document.getElementById("fn-ns").classList.contains("selected");
                let foodEn_DontKnow = document.getElementById("fn-dk").classList.contains("selected");
                let foodEn_Sureness = foodEn_DontKnow ? 0 : foodEn_NotSure ? 1 : 2;

                let foodHe = document.getElementById("food-name-hebrew").value;
                let foodHe_NotSure = document.getElementById("t-ns").classList.contains("selected");
                let foodHe_DontKnow = document.getElementById("t-dk").classList.contains("selected");
                let foodHe_Sureness = foodHe_DontKnow ? 0 : foodHe_NotSure ? 1 : 2;

                let foodCompany = document.getElementById("company").value;
                let foodCompanyObject = foodCompany.length === 0 ? null : localCompanyNameToObject(foodCompany, window.TABLE_JSON_DATA);

                output.innerHTML = "Testing For Attempted XSS Attacks...";

                if (name.attemptedXSS() || foodEn.attemptedXSS() || foodHe.attemptedXSS()) {
                    output.innerHTML = "Nice try 😉";
                    submit.textContent = "Submit";
                    return;
                }

                if (document.getElementById("food-name-english").classList.contains("already-exists") || document.getElementById("food-name-hebrew").classList.contains("already-exists")) {
                    output.innerHTML = "Food already exists in the food list.";
                    submit.textContent = "Submit";
                    return;
                }

                output.innerHTML = "Building & Sending Request Packet...";
                requestUsingDetails(name, [foodEn, foodEn_Sureness], [foodHe, foodHe_Sureness], foodCompanyObject)
                    .then(response => {
                        output.innerHTML = response;
                        submit.textContent = "Submit";
                        document.getElementById("food-name-english").value = "";
                        document.getElementById("food-name-hebrew").value = "";
                        document.getElementById("company").value = "";
                    });
            }
            else {
                let name = document.getElementById("name2").value;
                let name_RatherNotProvide = document.getElementById("n-np2").classList.contains("selected");
                if (name.length === 0 && !name_RatherNotProvide) {
                    output.innerHTML = "Please provide a name, or select 'I'd rather not provide'.";
                    submit.textContent = "Submit";
                    return;
                }

                output.innerHTML = "Grabbing Images...";
                let imagebase64s = [];
                let canvas = document.createElement("canvas");
                for (let i = 1; i < 4; i++) {
                    let image = document.getElementById(`img${i}`);
                    image.width = 0; image.height = 0;
                    image.style.position = "absolute";
                    canvas.width = image.offsetWidth;
                    canvas.height = image.offsetHeight;                    
                    canvas.getContext("2d").drawImage(image, 0, 0);
                    image.src = "";
                    imagebase64s.push(canvas.toDataURL("image/png"));
                }
                
                requestUsingImages(name, imagebase64s)
                    .then(response => {
                        output.innerHTML = response;
                        submit.textContent = "Submit";
                    });
            }
        }
    </script>
</body>

</html>